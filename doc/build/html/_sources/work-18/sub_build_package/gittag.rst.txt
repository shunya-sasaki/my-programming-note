
Gitタグの更新
-------------

セマンティックバージョニング
^^^^^^^^^^^^^^^^^^^^^^^^^^^^

参考: `<https://github.com/joelparkerhenderson/versioning>`__

プログラムのバージョニング方法はいくつかあるが、
ここでは多くのプログラムで用いられている
**セマンティックバージョンニング** について説明する。

セマンティックバージョニングでは「1.21.3」のように"."で区切った
3つの数字でバージョン番号が付けられる。各数字は前から順番に
**メジャーバージョン**、 **マイナーバージョン** 、
**パッチバージョン** と呼ばれる。

各バージョン番号はプログラムのアップデート時に更新内容に合わせて
バージョンを上げるかが決定される。

+--------------------------------------+--------------------+
| 更新内容                             | 更新対象           |
+======================================+====================+
| APIの変更に互換性がない場合          | メジャーバージョン |
+--------------------------------------+--------------------+
| 後方互換性があり機能性を追加した場合 | マイナーバージョン |
+--------------------------------------+--------------------+
| 後方互換性を伴うバグ修正をした場合   | パッチバージョン   |
+--------------------------------------+--------------------+


Gitタグ
^^^^^^^

gitのコミットはハッシュ番号で管理されるが、これを参照しやすくするために
タグを付けられる。なお、明示的に指定しない場合、
タグは現在のブランチの最新コミットに対して付与される。

**コマンドライン**

.. code-block:: sh

    git tag -a <tag> -m '<comment>'

明示的にコミットを指定する場合は以下を実行する。

.. code-block:: sh

    git tag -a <tag> -m '<comment>' <commit>

**VS Code(GUI)**

1. 画面左のGitタブを開く
2. アクションメニューから"Tags" -> "Create Tag"を選択
3. タグ名を入力する
4. コメントを入力する

タグ付はコミットと同様にローカルのリポジトリにのみ反映される。
リモートリポジトリに反映するには明示的にタグを指定してプッシュする必要がある。
以下にコマンドを示す。

.. code-block:: 

    git push <remote repogitory> <tag>

例えばリモートリポジトリ"origin"にタグ"1.23.1"をプッシュするときは以下のようになる。

.. code-block:: 

    git push origin 1.23.1

.. note:: 

    **タグ付はいつ行うか?**
        一般的にはプログラムのリリース時など区切りがいい時に行う


setuptools-scmによる自動番号付
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

setuptools-scmでは最新のgitタグを参照してプログラムのバージョンが付けられる。
デフォルトの設定では以下のようにバージョン番号が決まる。

+------------------------+------------------------+--------------------------------------------------------------+
| 最新コミットへのタグ付 | 更新中のファイルの有無 | バージョン番号                                               |
+========================+========================+==============================================================+
| ある                   | ない                   | 最新のタグ                                                   |
+------------------------+------------------------+--------------------------------------------------------------+
| ある                   | ある                   | 最新のタグ+現在の日付                                        |
+------------------------+------------------------+--------------------------------------------------------------+
| ない                   | ない                   | 次バージョンのタグ.dev<何コミット離れているか>+ハッシュ      |
+------------------------+------------------------+--------------------------------------------------------------+
| ない                   | ある                   | 次バージョンのタグ.dev<何コミット離れているか>+ハッシュ.日付 |
+------------------------+------------------------+--------------------------------------------------------------+


.. note:: 

    次バージョンのタグは最新のタグから自動的に計算される。
    例えば最新バージョンのタグが「1.23.1」だった場合、
    次バージョンは「1.23.2」となる。
